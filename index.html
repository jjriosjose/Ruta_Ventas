<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gesti√≥n de Llamadas - LLAMADAS v7.6.100</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
  
  <style>
    :root{ --bg:#0b1220; --card:#131c2b; --muted:#90a0b7; --text:#e8eef9; --primary:#2dd4bf; --danger:#ef4444; --chip:#1f2a40;}
    *{box-sizing:border-box;} body{ margin:0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background:linear-gradient(180deg,#0b1220 0%,#0e1626 100%); color:var(--text);}
    a{ color: var(--primary); text-decoration: none;} .container{ max-width:1200px; margin:0 auto; padding:16px;}
    .app-title{ display:flex; align-items:center; gap:10px; margin:8px 0 16px;} .badge{ padding:2px 8px; border-radius:999px; background:var(--chip); color:#a7b3c8; font-size:12px;}
    .row{ display:flex; gap:16px; flex-wrap:wrap;} .col{ flex:1 1 320px; min-width:320px;}
    .card{ background:rgba(19,28,43,0.9); border:1px solid #22304a; border-radius:16px; padding:12px; box-shadow: 0 10px 30px rgba(0,0,0,.25);}
    .title{ font-size:18px; margin:0 0 6px;} .muted{ color:#90a0b7; font-size:12px;}
    .grid{ display:grid; gap:8px;} .grid-2{ grid-template-columns: repeat(2, minmax(0,1fr)); } .grid-3{ grid-template-columns: repeat(3, minmax(0,1fr));}
    .filters{ display:grid; grid-template-columns: repeat(6,minmax(0,1fr)); gap:8px;}
    select,input[type="text"],input[type="password"],input[type="url"],textarea,input[type="number"],input[type="datetime-local"],input[type="date"],input[type="time"]{ width:100%; padding:10px; border-radius:10px; border:1px solid #314463; background:#0f1726; color:var(--text); outline:none;}
    textarea{ min-height:96px; resize:vertical; }
    .btn{ border:1px solid #28405f; background:#0f1726; color:var(--text); padding:8px 10px; border-radius:12px; cursor:pointer; transition:.15s; font-weight:600; font-size:12px;}
    .btn:hover{ transform: translateY(-1px); } .btn[disabled]{ opacity:.6; cursor:not-allowed;}
    .btn-primary{ background: linear-gradient(135deg, #1aa27f, #2dd4bf); border:0; color:#072018;} .btn-danger{ background: linear-gradient(135deg, #c2410c, #ef4444); border:0; color:#fff;}
    .btn-soft{ background:#101a2e; border:1px solid #2c3d5d;} .chip{ padding:2px 8px; font-size:11px; border-radius:999px; background:var(--chip); color:#a7b3c8; border:1px solid #2a3a59;}
    #map{ width:100%; height:62vh; border-radius:14px; overflow:hidden; border:1px solid #20314f; background:#0b1220;}
    .table{ width:100%; border-collapse: collapse; font-size:12px; border:1px solid #22304a; border-radius:12px; overflow:hidden;}
    .table th,.table td{ padding:8px 10px; border-bottom:1px solid #22304a;} .table th{ color:#9fb1cc; background:#0f182a; position:sticky; top:0; z-index:1;}
    .toolbar{ display:flex; gap:8px; flex-wrap:wrap; align-items:center;} .errbar{ position:fixed; left:8px; right:8px; bottom:8px; background:#2a1220; border:1px solid #6b273d; color:#ffd0df; padding:8px 10px; border-radius:12px; display:none;}
    .hidden{ display:none !important; } 
    .modal{ position:fixed; inset:0; background:rgba(0,0,0,.55); display:flex; align-items:center; justify-content:center; padding:16px; z-index:10000; backdrop-filter: blur(2px);}
    .modal.hidden{ display:none !important; }
    details{ background:#0e1626; border:1px solid #22304a; border-radius:10px; padding:8px; }
    details > summary{ cursor:pointer; color:#b7c7e3; }
    .no-scroll{ overflow:hidden; }
    .modal .card{ max-height:90vh; overflow:auto; }
    /* Agenda styles */
    .kanban{ display:flex; gap:12px; }
    .kcol{ flex:1 1 0; background:#0e1626; border:1px solid #22304a; border-radius:12px; padding:10px; min-height:320px; }
    .kcol h4{ margin:0 0 8px; }
    .kcard{ background:#0f1726; border:1px solid #293a59; border-radius:12px; padding:10px; margin-bottom:8px; }
    .khead{ font-weight:700; margin-bottom:2px; }
    .kmeta{ color:#9fb1cc; font-size:12px; }
  </style>
<style id="theme-override-light">
/* === Light, professional theme override (no logic changes) === */
:root{
  --bg:#f6f8fc;
  --card:#ffffff;
  --muted:#64748b;
  --text:#0b1220;
  --primary:#14b8a6;
  --danger:#ef4444;
  --chip:#eef2f7;
}
body{
  background:linear-gradient(180deg,#f6f8fc 0%, #eef2f7 100%);
  color:var(--text);
}
.badge{
  background:var(--chip);
  color:#5b6779;
}
.card{
  background:var(--card);
  border:1px solid #e5e9f2;
  box-shadow: 0 6px 16px rgba(15,23,42,.06);
}
.muted{ color: var(--muted); }
select,
input[type="text"],
input[type="password"],
input[type="url"],
textarea,
input[type="number"],
input[type="datetime-local"],
input[type="date"],
input[type="time"]{
  background:#ffffff;
  border:1px solid #d7dde8;
  color:var(--text);
}
.btn{
  border:1px solid #dbe1ea;
  background:#ffffff;
  color:#0b1220;
}
.btn-soft{
  background:#f4f7fb;
  border:1px solid #e1e7f0;
  color:#0b1220;
}
.btn-primary{
  background: linear-gradient(135deg, #10b981, #14b8a6);
  border:0;
  color:#ffffff;
}
.btn-danger{
  background: linear-gradient(135deg, #dc2626, #ef4444);
  border:0;
  color:#ffffff;
}
.chip{
  background:var(--chip);
  color:#475569;
  border:1px solid #e2e8f0;
}
#map{
  border:1px solid #dbe1ea;
  background:#eef2f7;
}
.table{
  border:1px solid #e5e9f2;
}
.table th, .table td{
  border-bottom:1px solid #eef2f7;
}
.table th{
  color:#64748b;
  background:#f4f7fb;
}
.errbar{
  background:#fde8e8;
  border:1px solid #f8b4b4;
  color:#7f1d1d;
}
.modal{
  background:rgba(0,0,0,.35);
}
details{
  background:#f7fafc;
  border:1px solid #e2e8f0;
}
details > summary{
  color:#334155;
}
.kanban{ gap:12px; }
.kcol{
  background:#f7fafc;
  border:1px solid #e2e8f0;
}
.kcard{
  background:#ffffff;
  border:1px solid #e5e9f2;
}
.kmeta{
  color:#64748b;
}
</style>


<style id="safe-override-resumen">
/* Hide duplicated Reporte (Resumen) buttons only inside LOGIN */
#login #btnReporteResumen { display: none !important; }
/* Hide the standalone launcher button */
#btnOpenResumenSem { display: none !important; }
/* Force the Resumen (Sem) screen to stay hidden in main layout */
#screenResumenSem { display: none !important; }
/* Show Resumen as a full-screen overlay when body has the flag */
body.show-resumen #screenResumenSem {
  display: block !important;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.45);
  z-index: 10000;
  overflow: auto;
  padding: 16px;
  backdrop-filter: blur(2px);
}
body.show-resumen #screenResumenSem > .card {
  width: min(1180px, 96vw);
  margin: 12px auto;
  max-height: 90vh;
  overflow: auto;
}
</style>

</head>
<body>
  <div class="container">
    <div class="app-title"><img alt="Almacenes Karaka" src="data:image/png;base64,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" style="height:28px; width:auto; object-fit:contain;"/> 
      <h2 style="margin:0;">Gesti√≥n de Llamadas</h2>
      <span class="badge">LLAMADAS v7.6.100</span>
      <span class="badge">Single-File</span>
    </div>

    <!-- LOGIN -->
    <section id="login" class="card">
      <h3 class="title">Ingreso</h3>
      <p class="muted">Conecta tus Google Sheets publicados (CSV) desde ‚öôÔ∏è <strong>Configurar</strong>. Demo: <code>demo / 1234</code> o <code>vendedor / 1234</code>.</p>
      <div class="grid grid-3">
        <div><label>Usuario</label><input id="loginUser" type="text" placeholder="ej: rmejia" autocomplete="username" /></div>
        <div><label>Contrase√±a</label><input id="loginPass" type="password" placeholder="********" autocomplete="current-password" /></div>
        <div class="grid"><label>&nbsp;</label><button id="btnLogin" class="btn btn-primary">Entrar</button></div>
      </div>
      <div class="toolbar" style="margin-top:6px;">
        <span class="chip">Modo: <span id="modeLabel">local</span></span>
        <span class="chip">Usuarios: <span id="usersCount">0</span></span>
        <button id="btnOpenConfig" class="btn btn-soft">‚öôÔ∏è Configurar</button>
      
<button id="btnReporteResumen" class="btn btn-soft">Reporte (Resumen)</button>
<button id="btnReporteResumen" class="btn btn-soft">Reporte (Resumen)</button></div>
    </section>

    <!-- APP -->
    <section id="app" class="hidden">
      <div class="card">
        <div class="toolbar">
          <button id="btnToggleFiltros" class="btn btn-soft">‚ò∞ Filtros</button>
          <div class="toolbar">
            <button id="btnAgenda" class="btn btn-soft">üóìÔ∏è Agenda</button>
            <button id="btnRegistrar" class="btn btn-soft" disabled>üìù Registrar llamada</button>
            <button id="btnReporte" class="btn btn-soft">üìä Reporte</button>
<button id="btnReporteResumen" class="btn btn-soft">Reporte (Resumen)</button>
            <button id="btnFicha" class="btn btn-soft">üëÅÔ∏è Ver ficha</button>
            <button id="btnNuevoCliente" class="btn btn-soft">‚ûï Nuevo cliente</button>
            <button id="btnExport" class="btn">‚≠≥ Exportar Excel</button>
            <button id="btnRestaurar" class="btn btn-danger">‚ü≤ Restaurar</button>
            <button id="btnOpenConfig2" class="btn btn-soft">‚öôÔ∏è Configurar</button>
            <button id="btnToggleLegend" class="btn btn-soft">üëÅÔ∏è Mostrar leyenda</button>
          </div>
          <div class="toolbar">
            <span class="chip">Clientes: <span id="statTotal">0</span></span>
            <span class="chip">Con coordenadas: <span id="statGeo">0</span></span>
            <span class="chip">Filtrados: <span id="statFilt">0</span></span>
          </div>
        </div>

        <div id="panelFiltros" class="card" style="margin-top:8px;">
          <div class="filters">
            <div><label>Semana</label><select id="fSemana"><option value="">Todas</option></select></div>
            <div><label>D√≠a</label><select id="fDia"><option value="">Todos</option></select></div>
            <div><label>Vendedor</label><select id="fVendedor"><option value="">Todos</option></select></div>
            <div><label>Gestor</label><select id="fGestor"><option value="">Todos</option></select></div>
            <div><label>Empresa</label><select id="fEmpresa"><option value="">Todas</option></select></div>
            <div><label>Buscar</label><input id="fBuscar" type="text" placeholder="Nombre o c√≥digo..." /></div>
          </div>
          <div style="margin-top:8px;" class="grid grid-2">
            <div><label>Cliente</label><select id="fCliente"><option value="">-- Seleccione --</option></select></div>
            <div class="toolbar hidden" id="legend"></div> <!-- hidden by default -->
          </div>
        </div>

        <div class="row" style="margin-top:8px;">
          <div class="col">
            <div id="map"></div>
            <div class="muted" id="hintZero" style="display:none; margin-top:6px;">No hay clientes con coordenadas en el filtro.</div>
          </div>
          <div class="col card">
            <h3 class="title">Clientes filtrados</h3>
            <div style="max-height:60vh; overflow:auto; border-radius:10px;">
              <table class="table" id="tbl">
                <thead><tr><th>Cod</th><th>Cliente</th><th>Semana</th><th>D√≠a</th><th>Vendedor</th><th>Gestor</th><th>Empresa</th></tr></thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Modal Config -->
  <div id="modalConfig" class="modal hidden" aria-modal="true" role="dialog">
    <div class="card" style="width:min(860px,96vw);">
      <h3 class="title">Configuraci√≥n - Conectar Google Sheets</h3>
      <p class="muted">Pega las URL publicadas como CSV de tus hojas. <em>Tip:</em> usa ‚ÄúAplicar ahora‚Äù para ver cambios sin recargar.</p>
      <div class="grid grid-2">
        <div>
          <label>Modo</label>
          <select id="cfgMode"><option value="local">local (demo)</option><option value="sheets">sheets (Google)</option></select>
        </div>
        <div>
          <label>Usuarios (CSV)</label>
          <input id="cfgUsuarios" type="url" disabled placeholder="https://docs.google.com/spreadsheets/.../pub?output=csv"/>
        </div>
        <div>
          <label>Clientes (CSV)</label>
          <input id="cfgClientes" type="url" disabled placeholder="https://docs.google.com/spreadsheets/.../pub?output=csv"/>
        </div>
        <div>
          <label>Calendario (CSV)</label>
          <input id="cfgCalendario" type="url" disabled placeholder="https://docs.google.com/spreadsheets/.../pub?output=csv"/>
        </div>
      </div>
      <details style="margin-top:8px;">
        <summary>Filtros avanzados</summary>
        <div class="grid">
          <div>
            <label>Excluir vendedores (uno por l√≠nea)</label>
            <textarea id="cfgExcluirVendedores" placeholder="Nombres a excluir..."></textarea>
          </div>
        </div>
      </details>
      <div class="toolbar" style="margin-top:8px;">
        <button id="btnCfgProbar" class="btn">Probar conexi√≥n</button>
        <button id="btnCfgGuardar" disabled class="btn btn-primary">Guardar & Recargar</button>
        <button id="btnCfgAplicar" disabled class="btn">Aplicar ahora (sin recargar)</button>
        <button id="btnCfgLimpiar" disabled class="btn btn-danger">Limpiar configuraci√≥n</button>
        <button id="btnCfgCerrar" class="btn btn-soft">Cerrar</button>
      </div>
      <p id="cfgStatus" class="muted" style="margin-top:6px;"></p>
    </div>
  </div>

  <!-- Modal Registrar Llamada -->
  <div id="modalLlamada" class="modal hidden" aria-modal="true" role="dialog">
    <div class="card" style="width:min(900px,96vw);">
      <h3 class="title">üìû Registrar llamada</h3>
      <div class="grid grid-2">
        <div><label>Cliente</label><input id="callCliente" type="text" readonly /></div>
        <div><label>Cod Empresa</label><input id="callCodEmpresa" type="text" readonly /></div>
        <div><label>Vendedor</label><input id="callVendedor" type="text" readonly /></div>
        <div><label>gestor_servicio</label><input id="callGestor" type="text" readonly /></div>
        <div><label>Fecha y hora</label><input id="callFechaHora" type="datetime-local" /></div>
        <div><label>N¬∞ Semana</label>
          <select id="callSemana">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
          </select>
        </div>
        <div><label>Resultado</label>
          <select id="callResultado">
<option value="Exitosa">Exitosa</option>
<option value="Gesti√≥n de pedido recibido">Gesti√≥n de pedido recibido</option>
<option value="No contesta">No contesta</option>
<option value="Ocupado">Ocupado</option>
<option value="N√∫mero equivocado">N√∫mero equivocado</option>
<option value="Rechazada">Rechazada</option>
</select>
        </div>
        <div><label>Duraci√≥n (seg.)</label><input id="callDuracion" type="number" min="0" step="1" value="0" /></div>
        <div></div>
        <div class="grid" style="grid-column:1/-1;"><label>Observaciones</label><textarea id="callObs" placeholder="Notas de la llamada..."></textarea></div>
      </div>
      <details style="margin-top:8px;">
        <summary>Contacto del cliente</summary>
        <div class="grid grid-3">
          <div><label>Tel√©fono 1</label><input id="callTelefono1" type="text" readonly /></div>
          <div><label>Celular</label><input id="callCelular" type="text" readonly /></div>
          <div><label>Provincia</label><input id="callProvincia" type="text" readonly /></div>
        </div>
      </details>
      <fieldset class="card" style="margin-top:10px;">
        <legend class="muted">Cita</legend>
        <div class="grid grid-3">
          <div><label>Tipo</label><select id="callCitaTipo">
            <option value="sin_cita">(sin cita)</option><option value="cita_showroom">Cita Showroom</option><option value="no_cita">No cita</option>
          </select></div>
          <div><label>Fecha</label><input id="callCitaFecha" type="date" /></div>
          <div><label>Hora</label><input id="callCitaHora" type="time" /></div>
        </div>
      </fieldset>
      <div class="toolbar" style="justify-content:flex-end; margin-top:10px;">
        <button id="btnCallCancelar" class="btn btn-soft">Cancelar</button>
        <button id="btnCallGuardar" class="btn btn-primary">Guardar</button>
      </div>
      <p id="callStatus" class="muted" style="margin-top:6px;"></p>
    </div>
  </div>

  <!-- Modal Reporte -->
  <div id="modalReporte" class="modal hidden" aria-modal="true" role="dialog">
    <div class="card" style="width:min(1100px,96vw);">
      <h3 class="title">üìä Reporte de llamadas</h3>
      <div class="grid grid-3">
        <div><label>Desde</label><input id="repDesde" type="date"/></div>
        <div><label>Hasta</label><input id="repHasta" type="date"/></div>
        <div><label>Vendedor</label><input id="repVendedor" type="text" placeholder="(todos)"/></div>
        <div><label>Gestor</label><input id="repGestor" type="text" placeholder="(todos)"/></div>
        <div><label>Resultado</label>
          <select id="repResultado">
            <option value="">(todos)</option><option>Exitosa</option><option>No contesta</option>
            <option>Ocupado</option><option>N√∫mero equivocado</option><option>Rechazada</option>
          </select>
        </div>
        <div><label>&nbsp;</label><button id="repExport" class="btn">‚¨á Exportar Excel</button></div>
      </div>
      
      <div class="toolbar" style="margin-top:6px; gap:8px; align-items:center;">
        <button id="repTabResumen" class="btn btn-soft">Resumen</button>
        <button id="repTabDetalle" class="btn btn-soft">Detalle</button>
        <div style="flex:1"></div>
        <button id="repSumExport" class="btn">‚¨á Exportar Resumen</button>
      </div>

      <div id="repResumenWrap" style="display:none; margin-top:8px; max-height:60vh; overflow:auto; border-radius:10px;">
        <table class="table" id="repSumTbl">
          <thead><tr>
            <th>Gestor</th><th>Semana</th><th>D√≠a</th>
            <th>A realizar</th><th>Realizadas</th><th>% Cobertura</th><th>√öltima llamada</th>
          </tr></thead>
          <tbody></tbody>
        </table>
      </div>
<div id="repDetalleWrap" style="margin-top:8px;max-height:60vh;overflow:auto;border-radius:10px;">
        <table class="table" id="repTbl">
          <thead><tr>
            <th>Fecha/Hora</th><th>Cliente</th><th>Cod</th><th>Vendedor</th><th>Gestor</th>
            <th>Resultado</th><th>Duraci√≥n</th><th>Obs</th><th>Provincia</th><th>Tel1</th><th>Cel</th><th>Cita</th><th>Estatus cita</th>
          </tr></thead><tbody></tbody>
        </table>
      </div>
      <div class="toolbar" style="justify-content:flex-end; margin-top:10px;"><button id="btnRepCerrar" class="btn btn-soft">Cerrar</button></div>
    </div>
  </div>

  <!-- Modal Agenda -->
  <div id="modalAgenda" class="modal hidden" aria-modal="true" role="dialog">
    <div class="card" style="width:min(1200px,96vw);">
      <h3 class="title">üóìÔ∏è Visitas programadas</h3>
      <div class="grid grid-3">
        <div><label>Desde</label><input id="agDesde" type="date"></div>
        <div><label>Hasta</label><input id="agHasta" type="date"></div>
        <div><label>Estatus</label>
          <select id="agStatus">
            <option value="">(todos)</option>
            <option>programada</option><option>asisti√≥</option><option>no asisti√≥</option>
            <option>reprogramada</option><option>cancelada</option>
          </select>
        </div>
        <div><label>Vendedor</label><select id="agVendedor"><option value="">(todos)</option></select></div>
        <div><label>Gestor</label><select id="agGestor"><option value="">(todos)</option></select></div>
        <div style="display:flex;align-items:end;justify-content:flex-end;"><button id="agOpenReport" class="btn">üßæ Gesti√≥n de visita</button> <button id="agExport" class="btn">‚¨á Exportar Excel</button></div>
      </div>
      <div class="kanban" style="margin-top:10px;">
        <div class="kcol"><h4>Hoy</h4><div id="agHoy"></div></div>
        <div class="kcol"><h4>Esta semana</h4><div id="agSemana"></div></div>
        <div class="kcol"><h4>Futuras</h4><div id="agFuturas"></div></div>
      </div>
      <div class="toolbar" style="justify-content:flex-end; margin-top:10px;">
        <button id="btnAgCerrar" class="btn btn-soft">Cerrar</button>
      </div>
    </div>
  </div>

  
  <!-- Modal Gesti√≥n de Visita -->
  <div id="modalAgReporte" class="modal hidden" aria-modal="true" role="dialog">
    <div class="card" style="width:min(1100px,96vw);">
      <h3 class="title">üßæ Gesti√≥n de visita (Agenda)</h3>

      <div class="grid grid-3">
        <div><label>Desde</label><input id="gvDesde" type="date"></div>
        <div><label>Hasta</label><input id="gvHasta" type="date"></div>
        <div><label>Estatus</label>
          <select id="gvStatus">
            <option value="">(todos)</option>
            <option>programada</option><option>asisti√≥</option><option>no asisti√≥</option>
            <option>reprogramada</option><option>cancelada</option>
          </select>
        </div>
        <div><label>Vendedor</label><select id="gvVendedor"><option value="">(todos)</option></select></div>
        <div><label>Gestor</label><select id="gvGestor"><option value="">(todos)</option></select></div>
        <div style="display:flex;align-items:end;justify-content:flex-end;">
          <button id="gvExport" class="btn">‚¨á Exportar Excel</button>
        </div>
      </div>

      <div style="margin-top:8px;max-height:60vh;overflow:auto;border-radius:10px;">
        <table class="table" id="gvTbl">
          <thead>
            <tr>
              <th>Fecha</th><th>Hora</th><th>D√≠a</th>
              <th>Cliente</th><th>Cod</th>
              <th>Vendedor</th><th>Gestor</th>
              <th>Estatus</th><th>Tipo</th><th>Obs</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div class="toolbar" style="justify-content:flex-end; margin-top:10px;">
        <button id="btnGvCerrar" class="btn btn-soft">Cerrar</button>
      </div>
    </div>
  </div>

  
  <button id="btnOpenResumenSem" class="btn" style="margin-left:8px;">üìä Resumen (Sem)</button>

  
  <!-- === Pantalla: Reporte de Llamadas ‚Äî Resumen (Semanal) === -->
  <section id="screenResumenSem" style="display:none;">
    <div class="card" style="margin:12px auto; width:min(1180px,96vw);">
      <div class="toolbar" style="gap:10px; align-items:center; flex-wrap:wrap;">
        <h3 style="margin:6px 12px 6px 0;">üìà Reporte de Llamadas ‚Äî Resumen (Semanal)</h3>
        <div style="display:flex; gap:10px; flex-wrap:wrap; margin-left:auto">
          <div><label>Semana</label>
            <select id="rwSemana">
              <option value="">Todas</option>
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
            </select>
          </div>
          <div><label>Vendedor</label><select id="rwVendedor"><option value="">Todos</option></select></div>
          <div><label>Gestor</label><select id="rwGestor"><option value="">Todos</option></select></div>
          <button id="rwExport" class="btn">‚¨á Exportar Excel</button>
          <button id="rwVolver" class="btn btn-soft">‚Üê Volver</button>
        </div>
      </div>

      <div class="toolbar" style="gap:12px; flex-wrap:wrap; margin-top:6px;">
        <span class="chip">A realizar: <strong id="rwPlan">0</strong></span>
        <span class="chip">Realizadas: <strong id="rwDone">0</strong></span>
        <span class="chip">% Cobertura: <strong id="rwCov">0%</strong></span>
        <span id="rwInfo" class="muted"></span>
      </div>
<div id="rwKpis" class="row" style="margin-top:8px;">
  <div class="col">
    <div class="card" style="text-align:center; padding:14px 10px;">
      <div class="muted">A realizar (Itinerarios)</div>
      <div id="kpiPlan" style="font-size:28px; font-weight:800;">0</div>
    </div>
  </div>
  <div class="col">
    <div class="card" style="text-align:center; padding:14px 10px;">
      <div class="muted">Realizadas (Llamadas)</div>
      <div id="kpiDone" style="font-size:28px; font-weight:800;">0</div>
    </div>
  </div>
  <div class="col">
    <div class="card" style="text-align:center; padding:14px 10px;">
      <div class="muted">% Cobertura</div>
      <div id="kpiCov" style="font-size:28px; font-weight:800;">0%</div>
    </div>
  </div>
</div>


      <div style="margin-top:8px; max-height:calc(84vh - 160px); overflow:auto; border-radius:12px;">
        <table class="table" id="rwTbl">
          <thead>
            <tr>
              <th>Gestor</th>
              <th>Semana</th>
              <th>A realizar</th>
              <th>Realizadas</th>
              <th>% Cobertura</th>
              <th>√öltima llamada</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </section>

  <div class="errbar" id="errbar"></div>







<!-- Modal Ver Ficha -->
<div id="modalFicha" class="modal hidden" aria-modal="true" role="dialog">
  <div class="card" style="width:min(700px, 90vw); max-height:90vh; overflow:auto;">
    <h3 class="title">üëÅÔ∏è Ficha del Cliente</h3>
    <div class="grid grid-2">
      <div><label>C√≥digo</label><input id="fichaCod" type="text" readonly /></div>
      <div><label>Nombre / Raz√≥n Social</label><input id="fichaNombre" type="text" readonly /></div>
      <div><label>Latitud</label><input id="fichaLat" type="text" readonly /></div>
      <div><label>Longitud</label><input id="fichaLon" type="text" readonly /></div>
      <div><label>Tel√©fono</label><input id="fichaTel" type="text" readonly /></div>
      <div><label>Celular</label><input id="fichaCel" type="text" readonly /></div>
      <div><label>Provincia</label><input id="fichaProv" type="text" readonly /></div>
      <div><label>Vendedor</label><input id="fichaVend" type="text" readonly /></div>
      <div><label>Gestor</label><input id="fichaGestor" type="text" readonly /></div>
      <div><label>Empresa</label><input id="fichaEmpresa" type="text" readonly /></div>
    </div>
    <div class="toolbar" style="justify-content:flex-end; margin-top:10px;">
      <button onclick="closeFichaModal()" class="btn btn-soft">Cerrar</button>
    </div>
  </div>
</div>

<div id="modalFicha" class="modal hidden" aria-modal="true" role="dialog">
  <div class="card" style="width:min(600px, 90vw);">
    <h3 class="title">üëÅÔ∏è Ficha del Cliente</h3>
    <p class="muted">Aqu√≠ se mostrar√° la informaci√≥n detallada del cliente seleccionado.</p>
    <div class="toolbar" style="justify-content:flex-end;">
      <button onclick="closeFichaModal()" class="btn btn-soft">Cerrar</button>
    </div>
  </div>
</div>


<!-- Modal Nuevo Cliente -->
<div id="modalNuevoCliente" class="modal hidden" aria-modal="true" role="dialog">
  <div class="card" style="width:min(700px, 90vw); max-height:90vh; overflow:auto;">
    <h3 class="title">‚ûï Nuevo Cliente</h3>
    <div class="grid grid-2">
      <div><label>C√≥digo</label><input id="nuevoCod" type="text" /></div>
      <div><label>Raz√≥n Social</label><input id="nuevoNombre" type="text" /></div>
      <div><label>Latitud</label><input id="nuevoLat" type="text" /></div>
      <div><label>Longitud</label><input id="nuevoLon" type="text" /></div>
      <div><label>Tel√©fono</label><input id="nuevoTel" type="text" /></div>
      <div><label>Celular</label><input id="nuevoCel" type="text" /></div>
      <div><label>Provincia</label><input id="nuevoProv" type="text" /></div>
      <div><label>Vendedor</label><input id="nuevoVend" type="text" /></div>
      <div><label>Gestor</label><input id="nuevoGestor" type="text" /></div>
      <div><label>Empresa</label><input id="nuevoEmpresa" type="text" /></div>
    </div>
    <div class="toolbar" style="justify-content:flex-end; margin-top:10px;">
      <button onclick="closeNuevoClienteModal()" class="btn btn-soft">Cancelar</button>
      <button onclick="guardarNuevoCliente()" class="btn btn-primary">Guardar</button>
    </div>
    <p id="nuevoClienteStatus" class="muted" style="margin-top:6px;"></p>
  </div>
</div>

<div id="modalNuevoCliente" class="modal hidden" aria-modal="true" role="dialog">
  <div class="card" style="width:min(600px, 90vw);">
    <h3 class="title">‚ûï Nuevo Cliente</h3>
    <p class="muted">Formulario para agregar un nuevo cliente (en desarrollo).</p>
    <div class="toolbar" style="justify-content:flex-end;">
      <button onclick="closeNuevoClienteModal()" class="btn btn-soft">Cerrar</button>
    </div>
  </div>
</div>




<!-- Modal Ver Ficha -->
<div id="modalFicha" class="modal hidden" aria-modal="true" role="dialog">
  <div class="card" style="width:min(700px, 90vw); max-height:90vh; overflow:auto;">
    <h3 class="title">üëÅÔ∏è Ficha del Cliente</h3>
    <div class="grid grid-2">
      <div><label>C√≥digo</label><input id="fichaCod" type="text" readonly /></div>
      <div><label>Nombre / Raz√≥n Social</label><input id="fichaNombre" type="text" readonly /></div>
      <div><label>Latitud</label><input id="fichaLat" type="text" readonly /></div>
      <div><label>Longitud</label><input id="fichaLon" type="text" readonly /></div>
      <div><label>Tel√©fono</label><input id="fichaTel" type="text" readonly /></div>
      <div><label>Celular</label><input id="fichaCel" type="text" readonly /></div>
      <div><label>Provincia</label><input id="fichaProv" type="text" readonly /></div>
      <div><label>Vendedor</label><input id="fichaVend" type="text" readonly /></div>
      <div><label>Gestor</label><input id="fichaGestor" type="text" readonly /></div>
      <div><label>Empresa</label><input id="fichaEmpresa" type="text" readonly /></div>
    </div>
    <div class="toolbar" style="justify-content:flex-end; margin-top:10px;">
      <button onclick="closeFichaModal()" class="btn btn-soft">Cerrar</button>
    </div>
  </div>
</div>

<div id="modalFicha" class="modal hidden" aria-modal="true" role="dialog">
  <div class="card" style="width:min(700px, 90vw); max-height:90vh; overflow:auto;">
    <h3 class="title">üëÅÔ∏è Ficha del Cliente</h3>
    <div class="grid grid-2">
      <div><label>C√≥digo</label><input id="fichaCod" type="text" readonly /></div>
      <div><label>Nombre / Raz√≥n Social</label><input id="fichaNombre" type="text" readonly /></div>
      <div><label>Latitud</label><input id="fichaLat" type="text" readonly /></div>
      <div><label>Longitud</label><input id="fichaLon" type="text" readonly /></div>
      <div><label>Tel√©fono</label><input id="fichaTel" type="text" readonly /></div>
      <div><label>Celular</label><input id="fichaCel" type="text" readonly /></div>
      <div><label>Provincia</label><input id="fichaProv" type="text" readonly /></div>
      <div><label>Vendedor</label><input id="fichaVend" type="text" readonly /></div>
      <div><label>Gestor</label><input id="fichaGestor" type="text" readonly /></div>
      <div><label>Empresa</label><input id="fichaEmpresa" type="text" readonly /></div>
    </div>
    <div class="toolbar" style="justify-content:flex-end; margin-top:10px;">
      <button onclick="closeFichaModal()" class="btn btn-soft">Cerrar</button>
    </div>
  </div>
</div>


<!-- Modal Nuevo Cliente -->
<div id="modalNuevoCliente" class="modal hidden" aria-modal="true" role="dialog">
  <div class="card" style="width:min(700px, 90vw); max-height:90vh; overflow:auto;">
    <h3 class="title">‚ûï Nuevo Cliente</h3>
    <div class="grid grid-2">
      <div><label>C√≥digo</label><input id="nuevoCod" type="text" /></div>
      <div><label>Raz√≥n Social</label><input id="nuevoNombre" type="text" /></div>
      <div><label>Latitud</label><input id="nuevoLat" type="text" /></div>
      <div><label>Longitud</label><input id="nuevoLon" type="text" /></div>
      <div><label>Tel√©fono</label><input id="nuevoTel" type="text" /></div>
      <div><label>Celular</label><input id="nuevoCel" type="text" /></div>
      <div><label>Provincia</label><input id="nuevoProv" type="text" /></div>
      <div><label>Vendedor</label><input id="nuevoVend" type="text" /></div>
      <div><label>Gestor</label><input id="nuevoGestor" type="text" /></div>
      <div><label>Empresa</label><input id="nuevoEmpresa" type="text" /></div>
    </div>
    <div class="toolbar" style="justify-content:flex-end; margin-top:10px;">
      <button onclick="closeNuevoClienteModal()" class="btn btn-soft">Cancelar</button>
      <button onclick="guardarNuevoCliente()" class="btn btn-primary">Guardar</button>
    </div>
    <p id="nuevoClienteStatus" class="muted" style="margin-top:6px;"></p>
  </div>
</div>

<div id="modalNuevoCliente" class="modal hidden" aria-modal="true" role="dialog">
  <div class="card" style="width:min(700px, 90vw); max-height:90vh; overflow:auto;">
    <h3 class="title">‚ûï Nuevo Cliente</h3>
    <div class="grid grid-2">
      <div><label>C√≥digo</label><input id="nuevoCod" type="text" /></div>
      <div><label>Nombre / Raz√≥n Social</label><input id="nuevoNombre" type="text" /></div>
      <div><label>Latitud</label><input id="nuevoLat" type="text" /></div>
      <div><label>Longitud</label><input id="nuevoLon" type="text" /></div>
      <div><label>Tel√©fono</label><input id="nuevoTel" type="text" /></div>
      <div><label>Celular</label><input id="nuevoCel" type="text" /></div>
      <div><label>Provincia</label><input id="nuevoProv" type="text" /></div>
      <div><label>Vendedor</label><input id="nuevoVend" type="text" /></div>
      <div><label>Gestor</label><input id="nuevoGestor" type="text" /></div>
      <div><label>Empresa</label><input id="nuevoEmpresa" type="text" /></div>
    </div>
    <div class="toolbar" style="justify-content:flex-end; margin-top:10px;">
      <button onclick="closeNuevoClienteModal()" class="btn btn-soft">Cancelar</button>
      <button onclick="guardarNuevoCliente()" class="btn btn-primary">Guardar</button>
    </div>
    <p id="nuevoClienteStatus" class="muted" style="margin-top:6px;"></p>
  </div>
</div>









<!-- ===== Pantalla: Reporte Resumen ===== -->
<section id="screenResumen" style="display:none; padding:16px 0 40px 0;">
  <div class="card" style="padding:14px 18px;">
    <div class="toolbar" style="gap:8px; align-items:center; flex-wrap:wrap;">
      <h2 style="margin:0; font-size:20px;">Reporte de Llamadas ‚Äî Resumen</h2>
      <div style="flex:1"></div>
      <button id="rrExport" class="btn">‚¨á Exportar Excel</button>
      <button id="rrVolver" class="btn btn-soft">‚Üê Volver</button>
    </div>

    <div class="grid" style="grid-template-columns: repeat(4, minmax(0,1fr)); gap:12px; margin-top:12px;">
      <div>
        <label class="lbl">Semana</label>
        <select id="rrSemana" class="input"><option value="">Todas</option></select>
      </div>
      <div>
        <label class="lbl">D√≠a</label>
        <select id="rrDia" class="input">
          <option value="">Todos</option>
          <option>Lunes</option><option>Martes</option><option>Mi√©rcoles</option>
          <option>Jueves</option><option>Viernes</option><option>S√°bado</option><option>Domingo</option>
        </select>
      </div>
      <div>
        <label class="lbl">Vendedor</label>
        <select id="rrVendedor" class="input"><option value="">Todos</option></select>
      </div>
      <div>
        <label class="lbl">Gestor</label>
        <select id="rrGestor" class="input"><option value="">Todos</option></select>
      </div>
    
    </div>

    <div id="rrKpis" class="toolbar" style="gap:12px; margin-top:10px; flex-wrap:wrap;">
      <span class="chip">A realizar: <b id="kpiAsignadas">0</b></span>
      <span class="chip">Realizadas: <b id="kpiHechas">0</b></span>
      <span class="chip">Cobertura: <b id="kpiCobertura">0%</b></span>
    </div>

    <div style="margin-top:12px; max-height:60vh; overflow:auto; border-radius:10px;">

      <table class="table" id="rrTbl">
        <thead>
          <tr><th>Gestor</th><th>Semana</th><th>D√≠a</th><th>A realizar</th><th>Realizadas</th><th>% Cobertura</th><th>√öltima llamada</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</section>

















<!-- ==== Drill-down Detail + Excel Export (self-contained) ==== -->
<style>
  .dlp-card{background:#fff;border-radius:14px;box-shadow:0 6px 24px rgba(13,38,76,.12);padding:16px;margin:24px 0}
  .dlp-row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  .dlp-title{font-size:18px;font-weight:700;margin:0 0 10px}
  .dlp-chips{display:flex;gap:10px;margin:6px 0 14px;flex-wrap:wrap}
  .dlp-chip{background:#f1f5f9;border-radius:999px;padding:6px 10px;font-size:12px}
  .dlp-tabs{display:flex;gap:6px;margin:8px 0 12px}
  .dlp-tab{padding:8px 12px;border-radius:10px;border:1px solid #e2e8f0;background:#fff;cursor:pointer}
  .dlp-tab.active{background:#0ea5e9;color:#fff;border-color:#0ea5e9}
  .dlp-actions{margin-left:auto;display:flex;gap:8px}
  .dlp-btn{padding:8px 12px;border:1px solid #e2e8f0;border-radius:10px;background:#fff;cursor:pointer}
  .dlp-table{width:100%;border-collapse:collapse;margin-top:8px}
  .dlp-table th,.dlp-table td{border-bottom:1px solid #e5e7eb;padding:8px 10px;font-size:13px;text-align:left}
  .dlp-muted{opacity:.7}
  @media (prefers-color-scheme: dark){
    .dlp-card{background:#111827;color:#e5e7eb;border:1px solid #1f2937}
    .dlp-chip{background:#1f2937}
    .dlp-tab{background:#111827;border-color:#1f2937;color:#e5e7eb}
    .dlp-btn{background:#111827;border-color:#1f2937;color:#e5e7eb}
    .dlp-table th,.dlp-table td{border-color:#1f2937}
  }
</style>








<!-- === Safe patch: Screen Manager + Delegated Events (no ID removals) === -->















<!-- ======= INTEGRACI√ìN KPI SEMANAL ======= -->


<style>
  /* Overlay */
  #rsOverlay{position:fixed;inset:0;background:rgba(0,0,0,.5);backdrop-filter:blur(3px);display:none;align-items:flex-start;justify-content:center;overflow:auto;z-index:9999}
  #rsPanel{margin:28px 10px;width:1200px;max-width:95vw}
  .rs-card{background:#fff;border-radius:14px;box-shadow:0 10px 24px rgba(2,6,23,.08);padding:14px}
  .rs-muted{color:#64748b}
  .rs-title{font-size:18px;font-weight:800}
  .rs-grid{display:grid;gap:10px}
  @media(min-width:900px){ .rs-grid.cols-4{grid-template-columns:repeat(4,1fr)} .rs-grid.cols-3{grid-template-columns:repeat(3,1fr)} }
  .rs-pill{display:inline-flex;align-items:center;gap:6px;background:#e2e8f0;border-radius:999px;padding:6px 10px;font-size:12px}
  .rs-kpi{font-size:30px;font-weight:900}
  .rs-tab{padding:6px 10px;border-radius:8px;background:#e2e8f0}
  .rs-tab.active{background:#2563eb;color:#fff}
  table.rs-table{width:100%;border-collapse:collapse}
  table.rs-table th, table.rs-table td{padding:10px;border-bottom:1px solid #eef2f7;font-size:14px;text-align:left}
  table.rs-table th{font-size:12px;letter-spacing:.02em;text-transform:uppercase;color:#64748b}
</style>

<div id="rsOverlay">
  <div id="rsPanel">
    <div class="rs-card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div class="rs-title">üìû Reporte de llamadas ‚Äî <span class="rs-muted">Resumen (Semanal)</span></div>
        <div style="display:flex;gap:6px">
          <span id="rsChips" class="rs-muted" style="align-self:center;font-size:12px"></span>
          <button id="rsExport" class="rs-pill">Exportar Excel</button>
          <button id="rsClose" class="rs-pill">Cerrar</button>
        </div>
      </div>

      <div class="rs-grid cols-4" style="margin-top:10px">
        <div class="rs-card">
          <div class="rs-muted" style="font-size:12px">Semana</div>
          <select id="rsSemana" style="width:100%;padding:8px;border:1px solid #e5e7eb;border-radius:10px">
            <option value="Todas">Todas</option>
            <option>1</option><option>2</option><option>3</option><option>4</option>
          </select>
        </div>
        <div class="rs-card">
          <div class="rs-muted" style="font-size:12px">Vendedor (Reporte)</div>
          <div id="rsVendTag" class="rs-pill">‚Äî</div>
        </div>
        <div class="rs-card">
          <div class="rs-muted" style="font-size:12px">Gestor (Reporte)</div>
          <div id="rsGestTag" class="rs-pill">‚Äî</div>
        </div>
        <div class="rs-card">
          <div class="rs-muted" style="font-size:12px">Acciones</div>
          <div style="display:flex;gap:8px">
            <button id="rsSync" class="rs-pill">Sincronizar</button>
          </div>
        </div>
      </div>

      <div class="rs-grid cols-3" style="margin-top:10px">
        <div class="rs-card"><div class="rs-muted">A realizar (itinerarios)</div><div id="rsK1" class="rs-kpi">0</div></div>
        <div class="rs-card"><div class="rs-muted">Realizadas (llamadas)</div><div id="rsK2" class="rs-kpi">0</div></div>
        <div class="rs-card"><div class="rs-muted">% Cobertura</div><div id="rsK3" class="rs-kpi">0%</div></div>
      </div>

      <div class="rs-card" style="margin-top:10px">
        <div style="display:flex;gap:8px"><button id="rsTabPend" class="rs-tab active">Pendientes (Agenda)</button><button id="rsTabReal" class="rs-tab">Realizadas (Historial)</button></div>
        <div style="overflow:auto;margin-top:10px">
          <table class="rs-table" id="rsTblDet">
            <thead><tr>
              <th>Cod Empresa</th><th>Cliente</th><th>Semana</th><th>D√≠a</th><th>Vendedor</th><th>Gestor</th><th style="text-align:right">A realizar</th>
            </tr></thead>
            <tbody id="rsTbdDet"><tr><td colspan="7" style="text-align:center;color:#64748b">Cargando‚Ä¶</td></tr></tbody>
          </table>
        </div>
      </div>

      <div class="rs-card" style="margin-top:10px">
        <div style="overflow:auto">
          <table class="rs-table" id="rsTblRes">
            <thead><tr>
              <th>Gestor</th><th>Semana</th><th style="text-align:right">A realizar</th><th style="text-align:right">Realizadas</th><th style="text-align:right">% Cobertura</th><th style="text-align:right">√öltima llamada</th>
            </tr></thead>
            <tbody id="rsTbdRes"><tr><td colspan="6" style="text-align:center;color:#64748b">Cargando‚Ä¶</td></tr></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>









<script>
(function(){ 
  const CFG_KEY='cfg_llamadas_app';
  const AUTH_KEY='auth_llamadas_user';
  const DEFAULT_CFG={usuarios:'https://docs.google.com/spreadsheets/d/e/2PACX-1vSGjr-XdLSamHpGQfoORmLfntJbLd-UbFpD7NdMM14x2JdMhxOYHTWQBlhYCMDu0ZTy3AYS-1Y3q91Y/pub?gid=1395226434&single=true&output=csv', clientes:'https://docs.google.com/spreadsheets/d/e/2PACX-1vSGjr-XdLSamHpGQfoORmLfntJbLd-UbFpD7NdMM14x2JdMhxOYHTWQBlhYCMDu0ZTy3AYS-1Y3q91Y/pub?gid=1016315198&single=true&output=csv', calendario:'https://docs.google.com/spreadsheets/d/e/2PACX-1vSGjr-XdLSamHpGQfoORmLfntJbLd-UbFpD7NdMM14x2JdMhxOYHTWQBlhYCMDu0ZTy3AYS-1Y3q91Y/pub?gid=223681507&single=true&output=csv', backend:'https://docs.google.com/spreadsheets/d/e/2PACX-1vSGjr-XdLSamHpGQfoORmLfntJbLd-UbFpD7NdMM14x2JdMhxOYHTWQBlhYCMDu0ZTy3AYS-1Y3q91Y/pub?gid=143166931&single=true&output=csv'};

  const $ = (s)=>document.querySelector(s);
  const norm = s=>String(s||'').normalize('NFD').replace(/[\u0300-\u036f]/g,'').toLowerCase().trim();

  function loadCfg(){ try{ return Object.assign({}, DEFAULT_CFG, JSON.parse(localStorage.getItem(CFG_KEY)||'{}')); }catch(e){ return DEFAULT_CFG; } }
  function saveCfg(c){ localStorage.setItem(CFG_KEY, JSON.stringify(c)); }

  const STATE = { cfg: loadCfg(), users: [], me: null };

  async function fetchCSV(url){
    const txt = await fetch(url, {cache:'no-store'}).then(r=>r.text());
    // muy simple parse; si luego hay comas entrecomilladas, cambiamos a un parser completo
    return txt.split(/\r?\n/).filter(l=>l.trim().length).map(l=>l.split(','));
  }

  function mapUser(hdr,row){
    const H = hdr.map(h=>norm(h));
    const get = (arr)=>{ for(const name of arr){ const ix = H.indexOf(norm(name)); if(ix>-1) return row[ix]||''; } return '' };
    return { 
      Usuario:  get(['usuario','user','login','correo','email','vendedor','gestor']),
      Permiso:  get(['permiso','rol','role','perfil'])||'usuario',
      Password: get(['contrase√±a','contrasena','password','pass','clave'])
    };
  }

  async function loadUsers(){
    try{ 
      const rows = await fetchCSV(STATE.cfg.usuarios);
      if(!rows.length) return [];
      const hdr = rows[0];
      STATE.users = rows.slice(1).map(r=>mapUser(hdr,r)).filter(u=>u.Usuario);
      const uc = document.getElementById('usersCount'); if(uc) uc.textContent = STATE.users.length;
      const md = document.getElementById('modeLabel'); if(md) md.textContent = 'sheets';
      return STATE.users;
    }catch(err){
      console.error('Usuarios CSV error', err);
      const md = document.getElementById('modeLabel'); if(md) md.textContent = 'local';
      return [];
    }
  }

  function setView(v){ 
    const login = document.getElementById('login');
    const app   = document.getElementById('app');
    if(login) login.classList.toggle('hidden', v!=='login');
    if(app)   app.classList.toggle('hidden', v!=='app');
  }

  async function doLogin(){
    const u = (document.getElementById('loginUser')||{}).value||'';
    const p = (document.getElementById('loginPass')||{}).value||'';
    // demo fallback
    if(norm(u)==='demo' && p==='1234'){ STATE.me={usuario:'DEMO',permiso:'administrador'}; localStorage.setItem(AUTH_KEY, JSON.stringify(STATE.me)); setView('app'); return; }
    if(!STATE.users.length) await loadUsers();
    const cand = STATE.users.find(r=>norm(r.Usuario)===norm(u));
    if(!cand){ alert('Usuario no encontrado'); return; }
    const ok = (String(cand.Password||'')===p) || (p==='1234' && !cand.Password);
    if(!ok){ alert('Contrase√±a incorrecta'); return; }
    STATE.me = {usuario: cand.Usuario, permiso: cand.Permiso||'usuario'};
    localStorage.setItem(AUTH_KEY, JSON.stringify(STATE.me));
    setView('app');
  }

  // CONFIG MODAL
  function openConfig(){ 
    document.getElementById('cfgUsuarios').value   = STATE.cfg.usuarios;
    document.getElementById('cfgClientes').value   = STATE.cfg.clientes;
    const cal = document.getElementById('cfgCalendario'); if(cal) cal.value = STATE.cfg.calendario;
    document.getElementById('modalConfig').classList.remove('hidden');
  }
  function closeConfig(){ document.getElementById('modalConfig').classList.add('hidden'); }
  async function applyConfig(){ 
    STATE.cfg = {
      usuarios:   document.getElementById('cfgUsuarios').value.trim()   || STATE.cfg.usuarios,
      clientes:   document.getElementById('cfgClientes').value.trim()   || STATE.cfg.clientes,
      calendario: (document.getElementById('cfgCalendario')||{value:''}).value.trim() || STATE.cfg.calendario,
      backend:    STATE.cfg.backend
    };
    saveCfg(STATE.cfg);
    await loadUsers();
    alert('Guardado. Usuarios: '+STATE.users.length);
  }

  function boot(){
    // Semana 1..4 llenado inicial en filtro (si existe el select)
    const sel = document.getElementById('fSemana');
    if(sel && sel.options.length<=1){ [1,2,3,4].forEach(w=>{ const opt=document.createElement('option'); opt.value=String(w); opt.textContent='Semana '+w; sel.appendChild(opt); }); }
    document.getElementById('btnLogin')?.addEventListener('click', doLogin);
    document.getElementById('btnOpenConfig')?.addEventListener('click', openConfig);
    document.getElementById('btnOpenConfig2')?.addEventListener('click', openConfig);
    document.getElementById('btnCfgCerrar')?.addEventListener('click', closeConfig);
    document.getElementById('btnCfgGuardar')?.addEventListener('click', async()=>{ await applyConfig(); closeConfig(); });
    document.getElementById('btnCfgAplicar')?.addEventListener('click', applyConfig);
    document.getElementById('btnCfgLimpiar')?.addEventListener('click', ()=>{ localStorage.removeItem(CFG_KEY); STATE.cfg=loadCfg(); alert('Config restablecida'); });
    document.getElementById('btnCfgProbar')?.addEventListener('click', async()=>{ await loadUsers(); alert('Usuarios le√≠dos: '+STATE.users.length); });
    // Auto precarga
    loadUsers();
  }

  if(document.readyState==='loading') document.addEventListener('DOMContentLoaded', boot); else boot();
})();
</script>

</body>
</html>
